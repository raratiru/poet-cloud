# Generated by xtables-save v1.8.2 on Wed May 20 22:26:49 2020
*filter
:managed_input - [0:0]
:managed_output - [0:0]
:managed_martians - [0:0]
:managed_tcpflags - [0:0]
:managed_icmp - [0:0]
:all_input - [0:0]
:all_output - [0:0]
:log_ssh - [0:0]
:net_input - [0:0]
:drop_input_log - [0:0]
:drop_output_log - [0:0]
:net_output - [0:0]
:loc_input - [0:0]
:loc_output - [0:0]
:web_server - [0:0]

-A managed_input -s {{ ansible_facts.default_ipv6.address }}/{{ ansible_facts.default_ipv6.prefix }} -m comment --comment "Prevent Land Attack" -j DROP
-A managed_input -i lo -m comment --comment "Allow loopback" -j ACCEPT
-A managed_input -i {{ ansible_facts.default_ipv4.interface }} -j net_input
{% if dmz_interface is defined %}-A managed_input -i {{ dmz_interface }} -j loc_input{% endif %}
-A managed_input -j drop_input_log
-A managed_output -o lo -m comment --comment "Allow loopback" -j ACCEPT
-A managed_output -o {{ ansible_facts.default_ipv4.interface }} -j net_output
{% if dmz_interface is defined %}-A managed_output -o {{ dmz_interface }} -j loc_output{% endif %}
-A managed_output -j drop_output_log
-A managed_martians -s ::1/128 -m comment --comment "Node-scope unicast loopback address" -j DROP
-A managed_martians -s ::ffff:0.0.0.0/96 -m comment --comment "IPv4-mapped addresses" -j DROP
-A managed_martians -s ::/96 -m comment --comment "IPv4-compatible addresses" -j DROP
-A managed_martians -s 100::/64 -m comment --comment "Remotely triggered black hole addresses" -j DROP
-A managed_martians -s 2001:10::/28 -m comment --comment "Overlay routable cryptographic hash identifiers (ORCHID)" -j DROP
-A managed_martians -s 2001:db8::/32 -m comment --comment "Documentation prefix" -j DROP
-A managed_martians -s fc00::/7 -m comment --comment "Unique local addresses (ULA)" -j DROP
-A managed_martians -s fe80::/10 -m comment --comment "Link-local unicast" -j DROP
-A managed_martians -s fec0::/10 -m comment --comment "Site-local unicast (deprecated)" -j DROP
-A managed_martians -s 2002::/24 -m comment --comment "6to4 bogon (0.0.0.0/8)" -j DROP
-A managed_martians -s 2002:a00::/24 -m comment --comment "6to4 bogon (10.0.0.0/8)" -j DROP
-A managed_martians -s 2002:7f00::/24 -m comment --comment "6to4 bogon (127.0.0.0/8)" -j DROP
-A managed_martians -s 2002:a9fe::/32 -m comment --comment "6to4 bogon (169.254.0.0/16)" -j DROP
-A managed_martians -s 2002:ac10::/28 -m comment --comment "6to4 bogon (172.16.0.0/12)" -j DROP
-A managed_martians -s 2002:c000::/40 -m comment --comment "6to4 bogon (192.0.0.0/24)" -j DROP
-A managed_martians -s 2002:c000:200::/40 -m comment --comment "6to4 bogon (192.0.2.0/24)" -j DROP
-A managed_martians -s 2002:c0a8::/32 -m comment --comment "6to4 bogon (192.168.0.0/16)" -j DROP
-A managed_martians -s 2002:c612::/31 -m comment --comment "6to4 bogon (198.18.0.0/15)" -j DROP
-A managed_martians -s 2002:c633:6400::/40 -m comment --comment "6to4 bogon (198.51.100.0/24)" -j DROP
-A managed_martians -s 2002:cb00:7100::/40 -m comment --comment "6to4 bogon (203.0.113.0/24)" -j DROP
-A managed_martians -s 2002:e000::/20 -m comment --comment "6to4 bogon (224.0.0.0/4)" -j DROP
-A managed_martians -s 2002:f000::/20 -m comment --comment "6to4 bogon (240.0.0.0/4)" -j DROP
-A managed_martians -s 2002:ffff:ffff::/48 -m comment --comment "6to4 bogon (255.255.255.255/32)" -j DROP
-A managed_martians -s 2001::/40 -m comment --comment "Teredo bogon (0.0.0.0/8)" -j DROP
-A managed_martians -s 2001:0:a00::/40 -m comment --comment "Teredo bogon (10.0.0.0/8)" -j DROP
-A managed_martians -s 2001:0:7f00::/40 -m comment --comment "Teredo bogon (127.0.0.0/8)" -j DROP
-A managed_martians -s 2001:0:a9fe::/48 -m comment --comment "Teredo bogon (169.254.0.0/16)" -j DROP
-A managed_martians -s 2001:0:ac10::/44 -m comment --comment "Teredo bogon (172.16.0.0/12)" -j DROP
-A managed_martians -s 2001:0:c000::/56 -m comment --comment "Teredo bogon (192.0.0.0/24)" -j DROP
-A managed_martians -s 2001:0:c000:200::/56 -m comment --comment "Teredo bogon (192.0.2.0/24)" -j DROP
-A managed_martians -s 2001:0:c0a8::/48 -m comment --comment "Teredo bogon (192.168.0.0/16)" -j DROP
-A managed_martians -s 2001:0:c612::/47 -m comment --comment "Teredo bogon (198.18.0.0/15)" -j DROP
-A managed_martians -s 2001:0:c633:6400::/56 -m comment --comment "Teredo bogon (198.51.100.0/24)" -j DROP
-A managed_martians -s 2001:0:cb00:7100::/56 -m comment --comment "Teredo bogon (203.0.113.0/24)" -j DROP
-A managed_martians -s 2001:0:e000::/36 -m comment --comment "Teredo bogon (224.0.0.0/4)" -j DROP
-A managed_martians -s 2001:0:f000::/36 -m comment --comment "Teredo bogon (240.0.0.0/4)" -j DROP
-A managed_martians -s 2001:0:ffff:ffff::/64 -m comment --comment "Teredo bogon (255.255.255.255/32)" -j DROP
-A managed_martians -s ff00::/8 -m comment --comment "Multicast (Note: ff0e:/16 is global scope and may appear on the global internet.)" -j DROP
-A managed_tcpflags -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -m comment --comment "NEW Packets should start with SYN" -j DROP
-A managed_tcpflags -p tcp -m tcp --sport 0 --tcp-flags FIN,SYN,RST,ACK SYN -m comment --comment "Attacks From Shorewall Rules" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG NONE -m comment --comment "NULL packets" -j DROP
-A managed_tcpflags -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -m comment --comment "SYN flag checking" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG FIN,SYN,RST,PSH,ACK,URG -m comment --comment "XMAS packets" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG FIN,PSH,URG -m comment --comment "Attacks From Shorewall Rules" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags SYN,RST SYN,RST -m comment --comment "Attacks From Shorewall Rules" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags FIN,RST FIN,RST -m comment --comment "Attacks From Shorewall Rules" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags FIN,SYN FIN,SYN -m comment --comment "Attacks From Shorewall Rules" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags FIN,PSH,ACK FIN,PSH -m comment --comment "Attacks From Shorewall Rules" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags FIN,ACK FIN -m comment --comment "Attacks From Hardened Conf github" -j DROP
-A managed_tcpflags -p tcp -m tcp --tcp-flags ACK,URG URG -m comment --comment "Attacks From Hardened Conf github" -j DROP
-A managed_icmp -m limit --limit 1/sec --limit-burst 3 -j ACCEPT
-A managed_icmp -j DROP
-A all_input -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A all_input -m conntrack --ctstate INVALID -j DROP
-A all_input -p ipv6-icmp -j managed_icmp
-A all_input -p tcp -j managed_tcpflags
-A all_output -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A all_output -p ipv6-icmp -j managed_icmp
-A log_ssh -m hashlimit --hashlimit-upto 1/sec --hashlimit-burst 10 --hashlimit-mode srcip --hashlimit-name lograte -j LOG --log-prefix "IPT: SSH" --log-level 6
-A log_ssh -m limit --limit 1/sec --limit-burst 3 -j ACCEPT
-A log_ssh -j DROP
-A net_input -m conntrack --ctstate NEW,UNTRACKED -j managed_martians
-A net_input -j all_input
-A net_input -p tcp -m tcp --dport 22 -m comment --comment "Allow SSH" -j log_ssh
-A net_input -p tcp -m tcp --dport 80 -m comment --comment "Allow WEB" -j ACCEPT
-A net_input -p tcp -m tcp --dport 443 -m comment --comment "Allow SECURE WEB" -j ACCEPT
-A net_input -p udp -m udp --dport 546:547 -m comment --comment "Allow DHCP" -j ACCEPT
-A drop_input_log -m hashlimit --hashlimit-upto 1/sec --hashlimit-burst 10 --hashlimit-mode srcip --hashlimit-name lograte -j LOG --log-prefix "IPT: DROP OUTPUT" --log-level 6
-A drop_input_log -j DROP
-A drop_output_log -m hashlimit --hashlimit-upto 1/sec --hashlimit-burst 10 --hashlimit-mode srcip --hashlimit-name lograte -j LOG --log-prefix "IPT: DROP OUTPUT" --log-level 6
-A drop_output_log -j DROP
-A net_output -j all_output
-A net_output -p udp -m udp --dport 546:547 -m comment --comment "Allow DHCP" -j ACCEPT
-A net_output -p udp -m udp --dport 123 -m comment --comment "Allow ntp" -j ACCEPT
-A net_output -p udp -m udp --dport 5353 -m comment --comment "Allow DNS UDP" -j ACCEPT
-A net_output -p tcp -m tcp --dport 5353 -m comment --comment "Allow DNS TCP" -j ACCEPT
-A net_output -p tcp -m tcp --dport 21 -m comment --comment "Allow ftp" -j ACCEPT
-A net_output -p tcp -m tcp --dport 25 -m comment --comment "Allow outgoing emails" -j ACCEPT
-A net_output -p tcp -m tcp --dport 80 -m comment --comment "Allow outgoing web" -j ACCEPT
-A net_output -p tcp -m tcp --dport 443 -m comment --comment "Allow outgoing secure web" -j ACCEPT
-A loc_input -j all_input
-A loc_output -j all_output
-A loc_output -p tcp -m tcp --dport 22 -m comment --comment "Allow SSH" -j log_ssh
-A web_server -m hashlimit --hashlimit-upto 50/sec --hashlimit-burst 20 --hashlimit-mode srcip --hashlimit-name web_server_limit -j ACCEPT
-A web_server -j REJECT --reject-with icmp6-addr-unreachable
COMMIT
